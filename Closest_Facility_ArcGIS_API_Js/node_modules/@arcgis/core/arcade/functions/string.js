/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import t from"../ArcadePortal.js";import r from"../Attachment.js";import e from"../Dictionary.js";import n from"../Feature.js";import{p as o,d as a,t as i,O as u,v as s,C as f,u as c,s as p,a as d,b as l,M as y,f as m,n as h,i as A,j as g,c as w,o as I,q as v}from"../../chunks/languageUtils.js";import{layerFieldEsriConstants as b}from"../featureset/support/shared.js";import{convertDirection as j}from"./convertdirection.js";import{XXH as F}from"./hash.js";import U from"../../geometry/Extent.js";import E from"../../geometry/Multipoint.js";import P from"../../geometry/Point.js";import x from"../../geometry/Polygon.js";import T from"../../geometry/Polyline.js";import k from"../../geometry/SpatialReference.js";function N(t,r){if(t.x===r.x&&t.y===r.y){if(t.hasZ){if(t.z!==r.z)return!1}else if(r.hasZ)return!1;if(t.hasM){if(t.m!==r.m)return!1}else if(r.hasM)return!1;return!0}return!1}function C(o,a,i){if(null!==o)if(d(o)){if(a.updateUint8Array([61]),i.map.has(o)){const t=i.map.get(o);a.updateIntArray([61237541^t])}else{i.map.set(o,i.currentLength++);for(const t of o)C(t,a,i);i.map.delete(o),i.currentLength--}a.updateUint8Array([199])}else if(l(o)){if(a.updateUint8Array([61]),i.map.has(o)){const t=i.map.get(o);a.updateIntArray([61237541^t])}else{i.map.set(o,i.currentLength++);for(const t of o.toArray())C(t,a,i);i.map.delete(o),i.currentLength--}a.updateUint8Array([199])}else{if(h(o))return a.updateIntArray([o.getTime()]),void a.updateUint8Array([241]);if(m(o))return a.updateIntArray([o.length]),a.updateWithString(o),void a.updateUint8Array([41]);if(A(o))a.updateUint8Array([!0===o?1:0,113]);else{if(g(o))return a.updateFloatArray([o]),void a.updateUint8Array([173]);if(o instanceof r)throw new Error("Type not supported in Hash");if(o instanceof t)throw new Error("Type not supported in Hash");if(!(o instanceof e)){if(o instanceof n)throw new Error("Type not supported in Hash");if(o instanceof P)return a.updateIntArray([3833836621]),a.updateIntArray([0]),a.updateFloatArray([o.x]),a.updateIntArray([1]),a.updateFloatArray([o.y]),o.hasZ&&(a.updateIntArray([2]),a.updateFloatArray([o.z])),o.hasM&&(a.updateIntArray([3]),a.updateFloatArray([o.m])),a.updateIntArray([3765347959]),void C(o.spatialReference.wkid,a,i);if(o instanceof x){a.updateIntArray([1266616829]);for(let t=0;t<o.rings.length;t++){const r=o.rings[t],e=[];let n=null,u=null;for(let a=0;a<r.length;a++){const i=o.getPoint(t,a);if(0===a)n=i;else if(N(u,i))continue;u=i,a===r.length-1&&N(n,i)||e.push(i)}a.updateIntArray([1397116793,e.length]);for(let t=0;t<e.length;t++){const r=e[t];a.updateIntArray([3962308117,t]),C(r,a,i),a.updateIntArray([2716288009])}a.updateIntArray([2278822459])}return a.updateIntArray([3878477243]),void C(o.spatialReference.wkid,a,i)}if(o instanceof T){a.updateIntArray([4106883559]);for(let t=0;t<o.paths.length;t++){const r=o.paths[t];a.updateIntArray([1397116793,r.length]);for(let e=0;e<r.length;e++)a.updateIntArray([3962308117,e]),C(o.getPoint(t,e),a,i),a.updateIntArray([2716288009]);a.updateIntArray([2278822459])}return a.updateIntArray([2568784753]),void C(o.spatialReference.wkid,a,i)}if(o instanceof E){a.updateIntArray([588535921,o.points.length]);for(let t=0;t<o.points.length;t++){const r=o.getPoint(t);a.updateIntArray([t]),C(r,a,i)}return a.updateIntArray([1700171621]),void C(o.spatialReference.wkid,a,i)}if(o instanceof U)return a.updateIntArray([3483648373]),a.updateIntArray([0]),a.updateFloatArray([o.xmax]),a.updateIntArray([1]),a.updateFloatArray([o.xmin]),a.updateIntArray([2]),a.updateFloatArray([o.ymax]),a.updateIntArray([3]),a.updateFloatArray([o.ymin]),o.hasZ&&(a.updateIntArray([4]),a.updateFloatArray([o.zmax]),a.updateIntArray([5]),a.updateFloatArray([o.zmin])),o.hasM&&(a.updateIntArray([6]),a.updateFloatArray([o.mmax]),a.updateIntArray([7]),a.updateFloatArray([o.mmin])),a.updateIntArray([3622027469]),void C(o.spatialReference.wkid,a,i);if(o instanceof k)return a.updateIntArray([14]),void 0!==o.wkid&&null!==o.wkid&&a.updateIntArray([o.wkid]),void(o.wkt&&a.updateWithString(o.wkt));if(w(o))throw new Error("Type not supported in Hash");if(I(o))throw new Error("Type not supported in Hash");if(v(o))throw new Error("Type not supported in Hash");if(o===s)throw new Error("Type not supported in Hash");throw new Error("Type not supported in Hash")}if(a.updateUint8Array([223]),i.map.has(o)){const t=i.map.get(o);a.updateIntArray([61237541^t])}else{i.map.set(o,i.currentLength++);for(const t of o.keys()){a.updateIntArray([t.length]),a.updateWithString(t),a.updateUint8Array([251]);C(o.field(t),a,i),a.updateUint8Array([239])}i.map.delete(o),i.currentLength--}a.updateUint8Array([73])}}else a.updateUint8Array([0,139])}function L(r,h){r.portal=function(r,e){return h(r,e,(function(r,e,n){return o(n,1,1),new t(a(n[0]))}))},r.trim=function(t,r){return h(t,r,(function(t,r,e){return o(e,1,1),a(e[0]).trim()}))},r.tohex=function(t,r){return h(t,r,(function(t,r,e){o(e,1,1);const n=i(e[0]);return isNaN(n)?n:n.toString(16)}))},r.upper=function(t,r){return h(t,r,(function(t,r,e){return o(e,1,1),a(e[0]).toUpperCase()}))},r.proper=function(t,r){return h(t,r,(function(t,r,e){o(e,1,2);let n=1;2===e.length&&"firstword"===a(e[1]).toLowerCase()&&(n=2);const i=/\s/,u=a(e[0]);let s="",f=!0;for(let o=0;o<u.length;o++){let t=u[o];if(i.test(t))1===n&&(f=!0);else{t.toUpperCase()!==t.toLowerCase()&&(f?(t=t.toUpperCase(),f=!1):t=t.toLowerCase())}s+=t}return s}))},r.lower=function(t,r){return h(t,r,(function(t,r,e){return o(e,1,1),a(e[0]).toLowerCase()}))},r.guid=function(t,r){return h(t,r,(function(t,r,e){if(o(e,0,1),e.length>0)switch(a(e[0]).toLowerCase()){case"digits":return u().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return u();case"digits-hyphen-braces":return"{"+u()+"}";case"digits-hyphen-parentheses":return"("+u()+")"}return"{"+u()+"}"}))},r.console=function(t,r){return h(t,r,(function(r,e,n){return 0===n.length||(1===n.length?t.console(a(n[0])):t.console(a(n))),s}))},r.mid=function(t,r){return h(t,r,(function(t,r,e){o(e,2,3);let n=i(e[1]);if(isNaN(n))return"";if(n<0&&(n=0),2===e.length)return a(e[0]).substr(n);let u=i(e[2]);return isNaN(u)?"":(u<0&&(u=0),a(e[0]).substr(n,u))}))},r.find=function(t,r){return h(t,r,(function(t,r,e){o(e,2,3);let n=0;if(e.length>2){if(n=i(f(e[2],0)),isNaN(n))return-1;n<0&&(n=0)}return a(e[1]).indexOf(a(e[0]),n)}))},r.left=function(t,r){return h(t,r,(function(t,r,e){o(e,2,2);let n=i(e[1]);return isNaN(n)?"":(n<0&&(n=0),a(e[0]).substr(0,n))}))},r.right=function(t,r){return h(t,r,(function(t,r,e){o(e,2,2);let n=i(e[1]);return isNaN(n)?"":(n<0&&(n=0),a(e[0]).substr(-1*n,n))}))},r.split=function(t,r){return h(t,r,(function(t,r,e){let n;o(e,2,4);let u=i(f(e[2],-1));const s=c(f(e[3],!1));if(-1===u||null===u||!0===s?n=a(e[0]).split(a(e[1])):(isNaN(u)&&(u=-1),u<-1&&(u=-1),n=a(e[0]).split(a(e[1]),u)),!1===s)return n;const p=[];for(let o=0;o<n.length&&!(-1!==u&&p.length>=u);o++)""!==n[o]&&void 0!==n[o]&&p.push(n[o]);return p}))},r.text=function(t,r){return h(t,r,(function(t,r,e){return o(e,1,2),p(e[0],e[1])}))},r.concatenate=function(t,r){return h(t,r,(function(t,r,e){const n=[];if(e.length<1)return"";if(d(e[0])){const t=f(e[2],"");for(let r=0;r<e[0].length;r++)n[r]=p(e[0][r],t);return e.length>1?n.join(e[1]):n.join("")}if(l(e[0])){const t=f(e[2],"");for(let r=0;r<e[0].length();r++)n[r]=p(e[0].get(r),t);return e.length>1?n.join(e[1]):n.join("")}for(let o=0;o<e.length;o++)n[o]=p(e[o]);return n.join("")}))},r.reverse=function(t,r){return h(t,r,(function(t,r,e){if(o(e,1,1),d(e[0])){const t=e[0].slice(0);return t.reverse(),t}if(l(e[0])){const t=e[0].toArray().slice(0);return t.reverse(),t}throw new Error("Invalid Parameter")}))},r.replace=function(t,r){return h(t,r,(function(t,r,e){o(e,3,4);const n=a(e[0]),i=a(e[1]),u=a(e[2]);return 4!==e.length||c(e[3])?y(n,i,u):n.replace(i,u)}))},r.schema=function(t,r){return h(t,r,(function(t,r,o){if(o[0]instanceof n){const t=o[0].schema();return t?e.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},r.subtypes=function(t,r){return h(t,r,(function(t,r,a){if(o(a,1,1),a[0]instanceof n){const t=a[0].subtypes();return t?e.convertObjectToArcadeDictionary(t):null}throw new Error("Invalid Parameter")}))},r.subtypecode=function(t,r){return h(t,r,(function(t,r,e){if(o(e,1,1),e[0]instanceof n){const t=e[0].subtypes();if(!t)return null;if(t.subtypeField&&e[0].hasField(t.subtypeField)){const r=e[0].field(t.subtypeField);for(const e of t.subtypes)if(e.code===r)return e.code;return null}return null}throw new Error("Invalid Parameter")}))},r.subtypename=function(t,r){return h(t,r,(function(t,r,e){if(o(e,1,1),e[0]instanceof n){const t=e[0].subtypes();if(!t)return"";if(t.subtypeField&&e[0].hasField(t.subtypeField)){const r=e[0].field(t.subtypeField);for(const e of t.subtypes)if(e.code===r)return e.name;return""}return""}throw new Error("Invalid Parameter")}))},r.gdbversion=function(t,r){return h(t,r,(function(t,r,e){if(o(e,1,1),e[0]instanceof n)return e[0].gdbVersion();throw new Error("Invalid Parameter")}))},r.domain=function(t,r){return h(t,r,(function(t,r,u){if(o(u,2,3),u[0]instanceof n){const t=u[0].fullDomain(a(u[1]),void 0===u[2]?void 0:i(u[2]));return t&&t.domain?"coded-value"===t.domain.type||"codedValue"===t.domain.type?e.convertObjectToArcadeDictionary({type:"codedValue",name:t.domain.name,dataType:b[t.field.type],codedValues:t.domain.codedValues.map((t=>({name:t.name,code:t.code})))}):e.convertObjectToArcadeDictionary({type:"range",name:t.domain.name,dataType:b[t.field.type],min:t.domain.min,max:t.domain.max}):null}throw new Error("Invalid Parameter")}))},r.domainname=function(t,r){return h(t,r,(function(t,r,e){if(o(e,2,4),e[0]instanceof n)return e[0].domainValueLookup(a(e[1]),e[2],void 0===e[3]?void 0:i(e[3]));throw new Error("Invalid Parameter")}))},r.domaincode=function(t,r){return h(t,r,(function(t,r,e){if(o(e,2,4),e[0]instanceof n)return e[0].domainCodeLookup(a(e[1]),e[2],void 0===e[3]?void 0:i(e[3]));throw new Error("Invalid Parameter")}))},r.urlencode=function(t,r){return h(t,r,(function(t,r,n){if(o(n,1,1),null===n[0])return"";if(n[0]instanceof e){let t="";for(const r of n[0].keys()){const e=n[0].field(r);""!==t&&(t+="&"),t+=null===e?encodeURIComponent(r)+"=":encodeURIComponent(r)+"="+encodeURIComponent(e)}return t}return encodeURIComponent(a(n[0]))}))},r.hash=function(t,r){return h(t,r,(function(t,r,e){o(e,1,1);const n=new F(0);return C(e[0],n,{map:new Map,currentLength:0}),n.digest()}))},r.convertdirection=function(t,r){return h(t,r,(function(t,r,e){return o(e,3,3),j(e[0],e[1],e[2])}))},r.fromjson=function(t,r){return h(t,r,(function(t,r,n){if(o(n,1,1),!1===m(n[0]))throw new Error("Invalid Parameter");return e.convertJsonToArcade(JSON.parse(a(n[0])))}))},r.expects=function(t,r){return h(t,r,(function(t,r,e){if(e.length<1)throw new Error("Function called with wrong number of Parameters");return s}))}}export{L as registerFunctions};
