/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import e from"../core/Error.js";import{isNone as t}from"../core/maybe.js";import{g as o,f as r,d as n,b as i,a as s}from"./vec3.js";import{c as a}from"./vec3f64.js";import{canProjectToWGS84ComparableLonLat as l}from"../geometry/projection.js";import{containsPoint as c,containsPointWithMargin as f,fromExtent as m,create as u}from"../geometry/support/aaBoundingRect.js";import{MAX_ROOT_TILES as p}from"../views/3d/terrain/TerrainConst.js";import h from"../views/3d/terrain/TilingScheme.js";const g=a(),d=a(),M=a(),j=a();function v(e,o,r=0){const n=e.extent;if(t(n))return!1;if(0===r)return c(n,o);const i=Math.min(n[2]-n[0],n[3]-n[1]);return f(n,o,r*i)}function x(e,t,a,l){o(g,a),g[l]=t[l];const c=r(g,g,t),f=r(d,e,t),m=n(f,c),u=n(c,c);let p;p=m<=0?t:u<=m?a:i(g,t,s(c,c,m/u));const h=r(g,e,p);return Math.PI/2-Math.atan(h[2]/Math.sqrt(h[0]*h[0]+h[1]*h[1]))}function S(e,o,r){const n=e.extent;if(t(n))return 0;M[0]=n[0],M[1]=n[1],M[2]=r,j[0]=n[2],j[1]=n[3],j[2]=r;let i=1/0,s=1/0;return o[0]<M[0]?i=x(o,M,j,0):o[0]>j[0]&&(i=x(o,j,M,0)),o[1]<M[1]?s=x(o,M,j,1):o[1]>j[1]&&(s=x(o,j,M,1)),Math.min(i,s)}function w(t,o,r){if(t.spatialReference.isGeographic&&!l(t.spatialReference))return new e("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const n=h.checkUnsupported(t);if(n)return n;const i=R(t,r);return i||(o&&!t.spatialReference.equals(o)?new e("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null)}function R(t,o){const r=t.lods,n=r[0].resolution*2**r[0].level,i=[n*t.size[0],n*t.size[1]],s=[t.origin.x,t.origin.y],a=m(o),l=u();h.computeRowColExtent(a,i,s,l);const c=(l[2]-l[0])*(l[3]-l[1]);if(c>p){const o=r[0].scale*2**r[0].level;let i=Math.max((a[3]-a[1])/t.size[1],(a[2]-a[0])/t.size[0])*o/n;const s=Math.floor(Math.log(i)/Math.log(10));return i=Math.ceil(i/10**s)*10**s,new e("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(o).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+i.toLocaleString()+".",{level0Scale:o,suggestedLevel0Scale:i,requiredNumRootTiles:c,allowedNumRootTiles:p})}return null}var T=Object.freeze({__proto__:null,isInsideExtent:v,tiltToExtentEdge:S,checkIfTileInfoSupportedForViewSR:w});export{S as a,w as c,v as i,T as t};
