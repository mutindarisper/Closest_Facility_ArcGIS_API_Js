/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import{setDeepValue as r}from"../../core/object.js";import{parse as t}from"./parser.js";function s(e,r,t){try{return a(e)}catch(s){t.messages&&t.messages.push(s)}return null}function n(e,t,s,n){try{const n=o(e);n&&r(s,n,t)}catch(a){n.messages&&n.messages.push(a)}}function o(e){if(!e)return null;if("string"==typeof e)return f(e);const r=[];for(const{scale:t,value:s}of e)r.push({scale:t,value:f(s)});return r}function a(e){if(!e)return null;if(c(e)){const r=[];for(const t of e)r.push({scale:t.scale,value:u(t.value)});return r}return u(e)}function c(e){const r=e[0];return!!r&&"scale"in r}function f(e){if(!e)return null;const r=t(e);if(r.error)throw r.error;return r.effects.map((e=>e.toJSON()))}function u(e){if(!e||!e.length)return null;const r=[];for(const s of e){let e=[];switch(s.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":e=[i(s,"amount")];break;case"blur":e=[i(s,"radius","pt")];break;case"hue-rotate":e=[i(s,"angle","deg")];break;case"drop-shadow":e=[i(s,"xoffset","pt"),i(s,"yoffset","pt"),i(s,"blurRadius","pt"),l(s,"color")];break;case"bloom":e=[i(s,"strength"),i(s,"radius","pt"),i(s,"threshold")]}const n=`${s.type}(${e.filter(Boolean).join(" ")})`,o=t(n);if(o.error)throw o.error;r.push(n)}return r.join(" ")}function i(r,t,s){if(null==r[t])throw new e("effect:missing-parameter",`Missing parameter '${t}' in ${r.type} effect`,{effect:r});return s?r[t]+s:""+r[t]}function l(r,t){if(null==r[t])throw new e("effect:missing-parameter",`Missing parameter '${t}' in ${r.type} effect`,{effect:r});const s=r[t];return`rgba(${s[0]||0} ${s[1]||0} ${s[2]||0} ${s[3]/255||0})`}export{u as effectFunctionsFromJSON,f as effectFunctionsToJSON,a as fromJSON,s as read,o as toJSON,n as write};
