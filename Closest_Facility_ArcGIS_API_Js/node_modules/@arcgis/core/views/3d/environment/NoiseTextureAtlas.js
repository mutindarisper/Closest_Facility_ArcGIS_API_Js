/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{releaseMaybe as e,disposeMaybe as t,isNone as i}from"../../../core/maybe.js";import"../../webgl/BufferObject.js";import r from"../../webgl/FramebufferObject.js";import"../../../core/has.js";import"../../webgl/checkWebGLError.js";import"../../webgl/enums.js";import"../../../chunks/builtins.js";import"../../webgl/renderState.js";import s from"../../webgl/Texture.js";import"../../webgl/VertexArrayObject.js";import{NoiseTextureAtlasTechnique as o}from"./NoiseTextureAtlasTechnique.js";import{createQuadVAO as h}from"../webgl-engine/lib/glUtil3D.js";class a{constructor(e,t){this._shapeTextureDescriptor={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,hasMipmap:!1,width:1,height:1},this._tileSize=1,this._tileRows=1,this._frameBuffer=new r(e,{colorTarget:0}),this._vao=h(e),this.textureAtlas=new s(e,this._shapeTextureDescriptor,null),this._technique=new o({rctx:e,viewingMode:t.state.viewingMode},null)}destroy(){this._technique=e(this._technique),this._frameBuffer=t(this._frameBuffer),this._vao=t(this._vao),this.textureAtlas=t(this.textureAtlas)}render(e,t){if(i(this._vao)||i(this.textureAtlas))return!1;this._tileSize=e,this._tileRows=Math.ceil(Math.sqrt(this._tileSize));const r=(e+2)*this._tileRows;this._frameBuffer.resize(r,r),this.textureAtlas.resize(r,r),this._frameBuffer.attachColorTexture(this.textureAtlas),t.bindFramebuffer(this._frameBuffer);const s=this._technique.program;t.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),this._technique.bindPipelineState(t),t.useProgram(s),s.setUniform1f("tileSize",this._tileSize),s.setUniform1f("tileRows",this._tileRows);const o=t.getViewport();return t.setViewport(0,0,r,r),t.gl.drawArrays(t.gl.TRIANGLE_STRIP,0,4),this._frameBuffer.detachColorTexture(),t.setViewport(o.x,o.y,o.width,o.height),!0}}export{a as NoiseTextureAtlas};
