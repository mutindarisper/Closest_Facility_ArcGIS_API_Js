/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{lerp as t,clamp as i}from"../../../core/mathUtils.js";import{i as e,c as n,j as o,r as a}from"../../../chunks/mat4.js";import{c as s}from"../../../chunks/mat4f64.js";import{s as l,e as u,m as r}from"../../../chunks/vec3.js";import{f as c,c as f,a as m}from"../../../chunks/vec3f64.js";import{S as d}from"../../../chunks/SunCalc.js";const h={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8e5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function g(e,n,o,a){const s=n[2];l(a.ambient.color,1,1,1),a.ambient.intensity=h.global.ambient,l(a.diffuse.color,1,1,1),a.diffuse.intensity=h.global.diffuse;const r=i((Math.abs(s)-h.local.altitude)/(h.global.altitude-h.local.altitude),0,1);a.globalFactor=r;const c=d.getTimes(e,n[1],n[0]);if(r<1){const i=E(e,c);u(a.ambient.color,i.ambient.color,a.ambient.color,r),a.ambient.intensity=t(i.ambient.intensity,a.ambient.intensity,r),u(a.diffuse.color,i.diffuse.color,a.diffuse.color,r),a.diffuse.intensity=t(i.diffuse.intensity,a.diffuse.intensity,r)}a.noonFactor=P(e,c),b(e,n,o,a.diffuse.directionToLightSource)}function b(t,s,u,c){const f=y,m=e(O);if(1===u)d.getPosition(t,0,0,f),l(c,0,0,-1),n(m,m,-f.azimuth),o(m,m,-f.altitude),r(c,c,m);else{const e=h.planarDirection,o=e.globalAngles,u=s[2];let g=(Math.abs(u)-e.localAltitude)/(e.globalAltitude-e.localAltitude);g=i(g,0,1),g<1?(d.getPosition(t,s[1],s[0],f),f.azimuth=(1-g)*f.azimuth+g*o.azimuth,f.altitude=(1-g)*f.altitude+g*o.altitude):(f.azimuth=o.azimuth,f.altitude=o.altitude),l(c,0,-1,0),a(m,m,-f.azimuth),n(m,m,-f.altitude),r(c,c,m)}}function A(t,i){if(1===i)return!0;const e=h.planarDirection;return Math.abs(t)<e.localAltitude}function p(t,i,e,n,o){const a=t.getTime(),s=i.getTime()-a,l=Math.floor(s/e)+1,u=new Array(l);for(let r=0;r<l;++r)M.setTime(a+e*r),u[r]=f(),b(M,n,o,u[r]);return u}const N=c(.5773502691896258,-.5773502691896258,.5773502691896258);class T{constructor(){this.ambient={color:c(1,1,1),intensity:.55},this.diffuse={color:c(1,1,1),intensity:.55,directionToLightSource:m(N)},this.noonFactor=.5,this.globalFactor=0}}const O=s(),y={azimuth:0,altitude:0};function P(t,e){const n=t.valueOf();let o,a;e.polarException===d.POLAR_EXCEPTION.MIDNIGHT_SUN?(o=n-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=o+432e6):e.polarException===d.POLAR_EXCEPTION.POLAR_NIGHT?(o=n-2,a=n-1):(o=e.sunrise.valueOf(),a=e.sunset.valueOf());const s=o+(a-o)/2;return 1-i(Math.abs(n-s)/432e5,0,1)}function E(t,i){const e=t.valueOf();let n,o;i.polarException===d.POLAR_EXCEPTION.MIDNIGHT_SUN?(n=e-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,o=n+432e6):i.polarException===d.POLAR_EXCEPTION.POLAR_NIGHT?(n=e-2,o=e-1):(n=i.sunrise.valueOf(),o=i.sunset.valueOf());const a=o-n,s=n+a/2,l=a/4,u=s-l,r=s+l,f=.06*a,m=n-f/2,g=n+f/2,b=o-f/2,A=o+f/2,p=h.local,N=[.01,p.ambientAtNight],T=[.8,.8,1],O=[.01,.01,.01],y=[p.diffuseAtTwilight,p.ambientAtTwilight],P=[1,.75,.75],E=[.8,.8,1],M=[.9*p.diffuseAtNoon,p.ambientAtNoon],z=[1,.98,.98],v=[.98,.98,1],L=[p.diffuseAtNoon,p.ambientAtNoon],_=[1,1,1],j=[1,1,1],D=M,w=z,H=v,R=y,S=P,k=E;let x,C,F=[0,0],G=[0,0,0],X=[0,0,0];return e<m||e>A?(F=N,G=O,X=T,C="night"):e<g?(x=g-m,F=I(e-m,x,N,y),G=I(e-m,x,O,P),X=I(e-m,x,T,E),C="sun rising"):e<u?(x=u-g,F=I(e-g,x,y,M),G=I(e-g,x,P,z),X=I(e-g,x,E,v),C="early morning"):e<s?(x=s-u,F=I(e-u,x,M,L),G=I(e-u,x,z,_),X=I(e-u,x,v,j),C="late morning"):e<r?(x=r-s,F=I(e-s,x,L,D),G=I(e-s,x,_,w),X=I(e-s,x,j,H),C="early afternoon"):e<b?(x=b-r,F=I(e-r,x,D,R),G=I(e-r,x,w,S),X=I(e-r,x,H,k),C="late afternoon"):e<A&&(x=A-b,F=I(e-b,x,R,N),G=I(e-b,x,S,O),X=I(e-b,x,k,T),C="sun setting"),{diffuse:{intensity:F[0],color:c(G[0],G[1],G[2])},ambient:{intensity:F[1],color:c(X[0],X[1],X[2])},timeOfDay:C}}function I(t,i,e,n){const o=[];for(let a=0;a<e.length;a++)o[a]=(n[a]-e[a])*t/i+e[a];return o}const M=new Date(0);export{T as ColorAndIntensity,g as computeColorAndIntensity,p as computeDirectionsOverTime,A as computeShadowsEnabled};
