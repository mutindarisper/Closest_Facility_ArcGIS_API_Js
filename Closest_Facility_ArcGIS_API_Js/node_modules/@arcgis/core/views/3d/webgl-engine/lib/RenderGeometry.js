/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{isNone as t,isSome as i,unwrapOr as r}from"../../../../core/maybe.js";import{generateUID as s}from"../../../../core/uid.js";import{e as a}from"../../../../chunks/mat4.js";import{c as n,I as e}from"../../../../chunks/mat4f64.js";import{m as o}from"../../../../chunks/vec3.js";import{c as h}from"../../../../chunks/vec4f64.js";import{maxScale as m}from"../../support/mathUtils.js";import{computeAttachmentOriginTriangles as u}from"./geometryDataUtils.js";import{Object3DStateID as f}from"./Object3DStateID.js";import{addObject3DStateID as c,removeObject3DStateID as d}from"../materials/renderers/utils.js";class l{constructor(t,i,r=null,a=null,e=s(),o=null,m=null,u=!1){this.data=t,this.material=i,this.layerUid=r,this.graphicUid=a,this.id=e,this.boundingInfo=o,this.calculateShaderTransformation=m,this.castShadow=u,this.boundingSphere=h(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this._transformation=n(),this._shaderTransformationDirty=!0}get transformation(){return this._transformation}updateTransformation(t){t(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(i,r,s=m(i)){t(this.boundingInfo)||(o(r,this.boundingInfo.getCenter(),i),r[3]=this.boundingInfo.getBSRadius()*s)}get hasShaderTransformation(){return i(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return t(this.calculateShaderTransformation)?r(this.transformation,e):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=n()),a(this._shaderTransformation,this.calculateShaderTransformation(r(this.transformation,e))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(i(this._transformation)&&o(t,t,this._transformation),!0);const r=this.indices.get("position"),s=this.vertexAttributes.get("position");return!!u(s,r,t)&&(i(this._transformation)&&o(t,t,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new f(0),i=this.instanceParameters;return i.highlights=c(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=d(i.highlights,t)}}class g extends l{}export{l as RenderGeometry,g as ValidatedRenderGeometry};
