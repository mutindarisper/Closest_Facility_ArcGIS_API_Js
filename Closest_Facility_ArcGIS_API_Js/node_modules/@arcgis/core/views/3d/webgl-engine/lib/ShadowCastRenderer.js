/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{disposeMaybe as i}from"../../../../core/maybe.js";import{g as s,c as t}from"../../../../chunks/vec4.js";import{f as e}from"../../../../chunks/vec4f64.js";import{createQuadVAO as a}from"./glUtil3D.js";import{ShadowCastTechniqueConfiguration as n,ShadowCastTechnique as o}from"../shaders/ShadowCastTechnique.js";import{vertexCount as h}from"../../../webgl/Util.js";const r=e(.01,0,.25,1),l=4e4,u=5e4,_=1/512;class d{constructor(i,s,t,e){this._techniqueRep=i,this._rctx=s,this._shadowAccumulator=t,this._requestRender=e,this._enabled=!1,this._vao=a(s),this._visualizationConfig=new n,this._visualizationConfig.pass=1,this._visualizationConfig.visualization=0,this._visualizeShadowCastTechnique=i.acquire(o,this._visualizationConfig),this._visualizationParams={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:r,threshold:.5,bandSize:.1,opacityFromElevation:1}}dispose(){this._stop(),this._vao=i(this._vao),this._visualizeShadowCastTechnique=i(this._visualizeShadowCastTechnique),this._shadowAccumulator=null}render(){this._isRenderingVisualization&&(this._sampleScale=1/this._computedSamples,this._rctx.bindVAO(this._vao),this._rctx.useProgram(this._visualizeShadowCastTechnique.program),this._visualizeShadowCastTechnique.bindPipelineState(this._rctx),this._visualizeShadowCastTechnique.bindPass(this._visualizationParams),this._rctx.drawArrays(this._visualizeShadowCastTechnique.primitiveType,0,h(this._vao,"geometry")))}setOptions(i){void 0!==i.enabled&&this._setEnabled(i.enabled),void 0!==i.color&&this._setColor(i.color),void 0!==i.threshold&&(this._threshold=i.threshold),void 0!==i.visualization&&(this._visualization=i.visualization),void 0!==i.bandSize&&(this._bandSize=i.bandSize),void 0!==i.bandsEnabled&&(this._bandsEnabled=i.bandsEnabled)}get opacityFromElevation(){return this._visualizationParams.opacityFromElevation}set opacityFromElevation(i){this._visualizationParams.opacityFromElevation=i}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>_}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _sampleScale(){return this._visualizationParams.sampleScale}set _sampleScale(i){this._visualizationParams.sampleScale=i}get _threshold(){return this._visualizationParams.threshold}set _threshold(i){this._threshold!==i&&(this._visualizationParams.threshold=i,this._requestRenderIfRunning())}get _visualization(){return this._visualizationConfig.visualization}set _visualization(i){if(i===this._visualization)return;const s=this._visualizationConfig;s.visualization=i,this._visualizeShadowCastTechnique=this._techniqueRep.releaseAndAcquire(o,s,this._visualizeShadowCastTechnique),this._requestRenderIfRunning()}get _bandSize(){return this._visualizationParams.bandSize}set _bandSize(i){i!==this._bandSize&&(this._visualizationParams.bandSize=i,this._requestRenderIfRunning())}get _bandsEnabled(){return this._visualizationConfig.bandsEnabled}set _bandsEnabled(i){if(i===this._bandsEnabled)return;const s=this._visualizationConfig;s.bandsEnabled=i,this._visualizeShadowCastTechnique=this._techniqueRep.releaseAndAcquire(o,s,this._visualizeShadowCastTechnique),this._requestRenderIfRunning()}_setColor(i){const e=this._visualizationParams.color;s(i,e)||(t(this._visualizationParams.color,i),this._requestRenderIfRunning())}_setEnabled(i){i!==this._enabled&&(i?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}}export{d as ShadowCastRenderer,u as shadowCastDisableElevationMax,l as shadowCastDisableElevationMin,_ as shadowCastDisabledElevationThreshold};
