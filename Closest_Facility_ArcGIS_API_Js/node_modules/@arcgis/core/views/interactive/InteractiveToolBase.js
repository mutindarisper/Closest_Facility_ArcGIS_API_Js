/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.21/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import e from"../../core/Accessor.js";import i from"../../core/Logger.js";import{isNone as o}from"../../core/maybe.js";import{createResolver as a}from"../../core/promiseUtils.js";import{property as s}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/accessorSupport/ensureType.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import{isDOMContainer as n}from"../DOMContainer.js";import{ManipulatorCollection as l}from"./ManipulatorCollection.js";const h=i.getLogger("esri.views.interactive.InteractiveToolBase");let c=class extends e{constructor(t){super(t),this.toolState="pending",this.completed=!1,this.manipulators=new l,this.updating=!1,this.automaticManipulatorSelection=!0,this._editableFlags=new Map([[1,!0],[0,!0]]),this._creationStartedResolver=a(),this._creationFinishedResolver=a()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(t){this._set("visible",t),t||this.active&&(this.view.activeTool=null),this.attached&&(t?this._show():this._hide())}get editable(){return this.getEditableFlag(0)}set editable(t){this.setEditableFlag(0,t)}get attached(){return this._get("attached")}get created(){return"created"===this.toolState}get cursor(){return null}attach(){this.attached?h.warn("Tool is already attached. Ignoring attach request."):(this.manipulators.attach(),this.onAttach(),this.visible&&this.onShow(),this._set("attached",!0))}detach(){this.attached?(this.visible&&this.onHide(),this.onDetach(),this.manipulators.detach(),this._set("attached",!1)):h.error("Tool isn't currently attached. Ignoring detach request.")}activate(){o(this.view)?h.error("Can't activate tool if view is not defined."):this.active?h.warn("Tool is already active, ignoring activation request."):(n(this.view)&&this.view.focus(),this.onActivate())}deactivate(){this.active?this.onDeactivate():h.warn("Tool is not active, ignoring deactivation request.")}handleInputEvent(t){this.attached?this.onInputEvent(t):h.warn("handleInputEvent() called on detached tool")}handleInputEventAfter(t){this.attached?this.onInputEventAfter(t):h.warn("handleInputEventAfter() called on detached tool")}destroy(){this.manipulators.destroy(),this._set("view",null),this._set("completed",!1)}setEditableFlag(t,e){this._editableFlags.set(t,e),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),0===t&&this.notifyChange("editable"),this.onEditableChange()}getEditableFlag(t){return this._editableFlags.get(t)}whenCreationStarted(){return this._creationStartedResolver.promise}when(){return this._creationFinishedResolver.promise}rejectCreation(t){"pending"!==this.toolState&&"creating"!==this.toolState||this._creationStartedResolver.resolve(this),this._creationFinishedResolver.reject(t)}onActivate(){}onDeactivate(){}onAttach(){}onDetach(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(t){}onInputEventAfter(t){}get internallyEditable(){return this.getEditableFlag(0)&&this.getEditableFlag(1)}startToolCreation(){if("pending"===this.toolState)return this._creationStartedResolver.resolve(this),void(this.toolState="creating");throw new Error(`Unexpected tool state ${this.toolState}`)}finishToolCreation(){switch(this.toolState){case"pending":this.startToolCreation();case"creating":this.created||this._creationFinishedResolver.resolve(this),this.toolState="created";break;case"created":break;default:throw new Error(`Unexpected tool state ${this.toolState}`)}}complete(){this.finishToolCreation(),this._set("completed",!0)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.attached&&this.visible?this.manipulators.attach():this.manipulators.detach()}};t([s()],c.prototype,"toolState",void 0),t([s({constructOnly:!0})],c.prototype,"view",void 0),t([s({readOnly:!0})],c.prototype,"active",null),t([s({value:!0})],c.prototype,"visible",null),t([s({value:!0})],c.prototype,"editable",null),t([s({value:!1,readOnly:!0})],c.prototype,"attached",null),t([s({readOnly:!0})],c.prototype,"created",null),t([s({readOnly:!0})],c.prototype,"completed",void 0),t([s({readOnly:!0})],c.prototype,"manipulators",void 0),t([s({readOnly:!0})],c.prototype,"updating",void 0),t([s()],c.prototype,"cursor",null),t([s()],c.prototype,"automaticManipulatorSelection",void 0),c=t([r("esri.views.interactive.InteractiveToolBase")],c);export{c as InteractiveToolBase};
