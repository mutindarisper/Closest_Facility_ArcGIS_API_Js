"use strict";(self.webpackChunkarcgis_rm=self.webpackChunkarcgis_rm||[]).push([[3963],{53963:(e,t,n)=>{n.r(t),n.d(t,{default:()=>B});var r=n(36663),i=(n(91957),n(80020)),o=(n(86004),n(45510),n(66908),n(2802),n(22836),n(50172),n(25634),n(72506)),s=n(54021),a=n(15842),l=n(81977),p=(n(39994),n(7283),n(13802),n(12571)),u=n(39835),c=n(59659),d=n(76136),y=n(70375),f=n(68309),m=n(61681),g=n(53237),h=n(51211),b=n(14685);const w="http://www.opengis.net/def/crs/OGC/1.3/CRS84";let v=class extends f.Z{constructor(){super(...arguments),this.featureDefinition=null,this.type="ogc-feature"}load(e){return this.addResolvingPromise(this._loadOGCServices(this.layer,e)),this.when()}getFeatureDefinition(){const{featureDefinition:{collection:e,layerDefinition:t,spatialReference:n,supportedCrs:r},layer:{apiKey:i,capabilities:o,customParameters:s}}=this;return{capabilities:o,collection:e,layerDefinition:t,queryParameters:{apiKey:i,customParameters:s},spatialReference:n,supportedCrs:r}}queryExtent(e,t={}){return null}queryFeatureCount(e,t={}){return null}queryFeatures(e,t={}){return this.queryFeaturesJSON(e,t).then((e=>h.default.fromJSON(e)))}queryFeaturesJSON(e,t={}){const n=this.getFeatureDefinition();return this.load(t).then((()=>(0,g.yN)(n,e,t)))}queryObjectIds(e,t={}){return null}supportsSpatialReference(e){return!(!e.isWGS84&&!e.isWebMercator&&!this.featureDefinition.supportedCrs[e.wkid])}_conformsToType(e,t){var n;const r=new RegExp(`^${t}$`,"i");return null!=(n=e.conformsTo.some((e=>r.test(e))))&&n}_getCapabilities(e,t){var n,r,i,o,s,a,l;const p=(0,m.pC)(t)?null==(n=t.components)?void 0:n.parameters:null;return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},query:{maxRecordCount:null!=(r=null!=(i=null==p||null==(o=p.limit)||null==(s=o.schema)?void 0:s.maximum)?i:null==p||null==(a=p.limitFeatures)||null==(l=a.schema)?void 0:l.maximum)?r:5e3,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1}}}_getExtent(e){var t;const n=null==(t=e.extent)?void 0:t.spatial;if(!n)return null;const r=n.bbox[0],i=4===r.length,o=r[0],s=r[1],a=i?void 0:r[2];return{xmin:o,ymin:s,xmax:i?r[2]:r[3],ymax:i?r[3]:r[4],zmin:a,zmax:i?void 0:r[5],spatialReference:b.Z.WGS84.toJSON()}}_getStorageSpatialReference(e){var t;const n=null!=(t=e.storageCrs)?t:w,r=(0,g.d)(n);return(0,m.Wi)(r)?b.Z.WGS84:new b.Z({wkid:r})}_getSupportedSpatialReferences(e,t){var n;const r="#/crs",i=null!=(n=e.crs)?n:[w],o=i.includes(r)?i.filter((e=>e!==r)).concat(t.crs):i,s=/^http:\/\/www\.opengis.net\/def\/crs\/epsg\/.*\/3785$/i;return o.filter((e=>!s.test(e)))}async _loadOGCServices(e,t){const n=(0,m.pC)(t)?t.signal:null,{apiKey:r,collectionId:i,customParameters:o,fields:s,geometryType:a,hasZ:l,objectIdField:p,timeInfo:u,url:d}=e,f={fields:null==s?void 0:s.map((e=>e.toJSON())),geometryType:c.P$.toJSON(a),hasZ:l,objectIdField:p,timeInfo:null==u?void 0:u.toJSON()},h={apiKey:r,customParameters:o,signal:n},b=await(0,g.gp)(d,h),[w,v]=await Promise.all([(0,g.G4)(b,h),(0,g.j)(b,h)]);if(!this._conformsToType(w,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/geojson"))throw new y.Z("ogc-feature-layer:no-geojson-support","Server does not support geojson");const F=v.collections.find((e=>e.id===i));if(!F)throw new y.Z("ogc-feature-layer:collection-not-found","Server does not contain the named collection");const S=this._conformsToType(w,"http://www.opengis.net/spec/ogcapi-features-1/1.0/conf/oas30")?await(0,g.eS)(b,h):null,C=await(0,g.w9)(F,f,h),I=this._getCapabilities(C.hasZ,S),T=this._getExtent(F),j=this._getStorageSpatialReference(F).toJSON(),x=this._getSupportedSpatialReferences(F,v),O={};for(const e of x){const t=(0,g.d)(e);(0,m.pC)(t)&&(O[t]=e)}C.extent=T,this.featureDefinition={capabilities:I,collection:F,layerDefinition:C,queryParameters:{},spatialReference:j,supportedCrs:O}}};(0,r._)([(0,l.Cb)()],v.prototype,"featureDefinition",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],v.prototype,"layer",void 0),(0,r._)([(0,l.Cb)()],v.prototype,"type",void 0),v=(0,r._)([(0,p.j)("esri.layers.graphics.sources.OGCFeatureSource")],v);var F=v,S=n(91223),C=n(48547),I=n(63989),T=n(43330),j=n(50386),x=n(18241),O=n(12478),_=n(95874),P=n(2030),R=n(51599),Z=n(94759),D=n(18160),k=n(12512),G=n(89076),M=n(17095),N=n(26732),q=n(49341),E=n(14136),W=n(10171),Q=n(91772);const A=(0,G.v)();let L=class extends((0,S.V)((0,I.N)((0,C.h)((0,j.c)((0,P.n)((0,_.M)((0,T.q)((0,x.I)((0,O.Q)((0,a.R)(d.Z))))))))))){constructor(e){super(e),this.collectionId=null,this.copyright=null,this.definitionExpression=null,this.description=null,this.displayField=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="OGCFeatureLayer",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new F({layer:this}),this.spatialReference=null,this.title=null,this.type="ogc-feature",this.typeIdField=null,this.types=null,this.url=null}destroy(){var e;null==(e=this.source)||e.destroy()}load(e){return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["OGCFeatureServer"]},e).then((()=>this._fetchService(e)))),this.when()}get defaultPopupTemplate(){return this.createPopupTemplate()}writeWebSceneFeatureReduction(e,t,n,r){(0,Z.Q6)(e,t,"layerDefinition.featureReduction",r)}get isTable(){return this.loaded&&null==this.geometryType}set renderer(e){(0,M.YN)(e,this.fieldsIndex),this._set("renderer",e)}on(e,t){return super.on(e,t)}createPopupTemplate(e){return(0,W.eZ)(this,e)}createQuery(){return new E.Z}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var n;let r,i=!1;const o=null==t||null==(n=t.feature)?void 0:n.attributes,s=this.typeIdField&&(null==o?void 0:o[this.typeIdField]);return null!=s&&this.types&&(i=this.types.some((t=>{var n,i;return t.id==s&&(r=null==(n=t.domains)?void 0:n[e],"inherited"===(null==(i=r)?void 0:i.type)&&(r=this._getLayerDomain(e)),!0)}))),i||r||(r=this._getLayerDomain(e)),r}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(E.Z.from(e)||this.createQuery(),t))).then((e=>{var t;return null==e||null==(t=e.features)||t.forEach((e=>{e.layer=e.sourceLayer=this})),e}))}async _fetchService(e){await this.source.load(e),this.read(this.source.featureDefinition,{origin:"service"}),(0,M.YN)(this.renderer,this.fieldsIndex),(0,M.UF)(this.timeInfo,this.fieldsIndex)}_getLayerDomain(e){if(!this.fields)return null;for(const t of this.fields)if(t.name===e&&t.domain)return t.domain;return null}};(0,r._)([(0,l.Cb)({readOnly:!0,json:{origins:{service:{read:!0}}}})],L.prototype,"capabilities",void 0),(0,r._)([(0,l.Cb)({type:String,json:{write:!0}})],L.prototype,"collectionId",void 0),(0,r._)([(0,l.Cb)({type:String})],L.prototype,"copyright",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],L.prototype,"defaultPopupTemplate",null),(0,r._)([(0,l.Cb)({type:String})],L.prototype,"definitionExpression",void 0),(0,r._)([(0,l.Cb)({readOnly:!0,type:String,json:{origins:{service:{name:"collection.description"}}}})],L.prototype,"description",void 0),(0,r._)([(0,l.Cb)({type:String})],L.prototype,"displayField",void 0),(0,r._)([(0,l.Cb)(R.PV)],L.prototype,"elevationInfo",void 0),(0,r._)([(0,l.Cb)(Z.dm)],L.prototype,"featureReduction",void 0),(0,r._)([(0,u.c)("web-scene","featureReduction",{"layerDefinition.featureReduction":{types:Z.Gx}})],L.prototype,"writeWebSceneFeatureReduction",null),(0,r._)([(0,l.Cb)({type:[k.Z],json:{origins:{service:{name:"layerDefinition.fields"}}}})],L.prototype,"fields",void 0),(0,r._)([(0,l.Cb)(A.fieldsIndex)],L.prototype,"fieldsIndex",void 0),(0,r._)([(0,l.Cb)({readOnly:!0,type:Q.Z,json:{origins:{service:{name:"layerDefinition.extent"}}}})],L.prototype,"fullExtent",void 0),(0,r._)([(0,l.Cb)({type:c.Mk.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",read:{reader:c.Mk.read}}}}})],L.prototype,"geometryType",void 0),(0,r._)([(0,l.Cb)({type:Boolean,json:{origins:{service:{name:"layerDefinition.hasZ"}}}})],L.prototype,"hasZ",void 0),(0,r._)([(0,l.Cb)({type:Boolean,readOnly:!0})],L.prototype,"isTable",null),(0,r._)([(0,l.Cb)({type:[N.Z],json:{origins:{"web-document":{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:q.r},write:!0}}}})],L.prototype,"labelingInfo",void 0),(0,r._)([(0,l.Cb)(R.iR)],L.prototype,"labelsVisible",void 0),(0,r._)([(0,l.Cb)(R.rn)],L.prototype,"legendEnabled",void 0),(0,r._)([(0,l.Cb)({type:String,json:{origins:{service:{name:"layerDefinition.objectIdField"}}}})],L.prototype,"objectIdField",void 0),(0,r._)([(0,l.Cb)({type:["OGCFeatureLayer"]})],L.prototype,"operationalLayerType",void 0),(0,r._)([(0,l.Cb)(R.C_)],L.prototype,"popupEnabled",void 0),(0,r._)([(0,l.Cb)({type:i.Z,json:{name:"popupInfo",write:!0}})],L.prototype,"popupTemplate",void 0),(0,r._)([(0,l.Cb)({types:s.A,json:{origins:{service:{name:"layerDefinition.drawingInfo.renderer",write:!1},"web-scene":{types:s.o,name:"layerDefinition.drawingInfo.renderer",write:{writer:o.cW}}},name:"layerDefinition.drawingInfo.renderer",write:!0}})],L.prototype,"renderer",null),(0,r._)([(0,l.Cb)({type:Boolean})],L.prototype,"screenSizePerspectiveEnabled",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],L.prototype,"source",void 0),(0,r._)([(0,l.Cb)({readOnly:!0,type:b.Z,json:{origins:{service:{read:!0}}}})],L.prototype,"spatialReference",void 0),(0,r._)([(0,l.Cb)({type:String,json:{write:{enabled:!0,ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"collection.title"}}}})],L.prototype,"title",void 0),(0,r._)([(0,l.Cb)({readOnly:!0,json:{read:!1}})],L.prototype,"type",void 0),(0,r._)([(0,l.Cb)({type:String,readOnly:!0})],L.prototype,"typeIdField",void 0),(0,r._)([(0,l.Cb)({type:[D.Z]})],L.prototype,"types",void 0),(0,r._)([(0,l.Cb)(R.HQ)],L.prototype,"url",void 0),L=(0,r._)([(0,p.j)("esri.layers.OGCFeatureLayer")],L);var B=L},10287:(e,t,n)=>{n.d(t,{g:()=>r});const r={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},61957:(e,t,n)=>{n.d(t,{lG:()=>S,q9:()=>a,my:()=>F,O3:()=>v});var r=n(70375),i=n(59958),o=n(15540);const s={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function a(e){return s[e]}function*l(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*p(e){if(!e)return null;switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function u(e){for(const t of e)if(t.length>2)return!0;return!1}function c(e){let t=0;for(let n=0;n<e.length;n++){const r=e[n],i=e[(n+1)%e.length];t+=r[0]*i[1]-i[0]*r[1]}return t<=0}function d(e){const t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]||e.push(t),e}function y(e,t,n){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,n){return g(e,t.coordinates,n),e}(e,t,n);case"MultiLineString":return function(e,t,n){for(const r of t.coordinates)g(e,r,n);return e}(e,t,n);case"MultiPolygon":return function(e,t,n){for(const r of t.coordinates){f(e,r[0],n);for(let t=1;t<r.length;t++)m(e,r[t],n)}return e}(e,t,n);case"Point":return function(e,t,n){return b(e,t.coordinates,n),e}(e,t,n);case"Polygon":return function(e,t,n){const r=t.coordinates;f(e,r[0],n);for(let t=1;t<r.length;t++)m(e,r[t],n);return e}(e,t,n)}}function f(e,t,n){const r=d(t);!function(e){return!c(e)}(r)?g(e,r,n):h(e,r,n)}function m(e,t,n){const r=d(t);!function(e){return c(e)}(r)?g(e,r,n):h(e,r,n)}function g(e,t,n){for(const r of t)b(e,r,n);e.lengths.push(t.length)}function h(e,t,n){for(let r=t.length-1;r>=0;r--)b(e,t[r],n);e.lengths.push(t.length)}function b(e,t,n){const[r,i,o]=t;e.coords.push(r,i),n.hasZ&&e.coords.push(o||0)}function w(e){switch(typeof e){case"string":return"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}function v(e){if(!e)throw new r.Z("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new r.Z("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:t}=e;if(!t)return;const n="string"==typeof t?t:"name"===t.type?t.properties.name:"EPSG"===t.type?t.properties.code:null,i=new RegExp(".*(CRS84H?|4326)$","i");if(!n||!i.test(n))throw new r.Z("geojson-layer:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:t})}function F(e,t={}){const n=[],r=new Set,i=new Set;let o,s=!1,c=Number.NEGATIVE_INFINITY,d=null,y=!1,{geometryType:f=null}=t,m=!1;for(const t of l(e)){const{geometry:e,properties:l,id:g}=t;if((!e||(f||(f=a(e.type)),a(e.type)===f))&&(s||(s=u(p(e))),y||(y=null!=g,y&&(o=typeof g,"number"===o&&(d=Object.keys(l).filter((e=>l[e]===g))))),y&&"number"===o&&null!=g&&(c=Math.max(c,g),d.length>1?d=d.filter((e=>l[e]===g)):1===d.length&&(d=l[d[0]]===g?d:[])),!m&&l)){let e=!0;for(const t in l){if(r.has(t))continue;const o=l[t];if(null==o){e=!1,i.add(t);continue}const s=w(o);"unknown"!==s?(i.delete(t),r.add(t),n.push({name:t,alias:t,type:s})):i.add(t)}m=e}}const g=d&&1===d.length&&d[0]||null;if(g)for(const e of n)e.name===g&&(e.type="esriFieldTypeOID");return{fields:n,geometryType:f,hasZ:s,maxObjectId:Math.max(0,c),objectIdFieldName:g,objectIdFieldType:o,unknownFields:Array.from(i)}}function S(e,t){return Array.from(function*(e,t={}){const{geometryType:n,objectIdField:r}=t;for(const l of e){var s;const{geometry:e,properties:p,id:u}=l;if(e&&a(e.type)!==n)continue;const c=p||{};let d=null!=(s=c[r])?s:null;r&&null!=u&&!c[r]&&(c[r]=d=u);const f=new i.ZP(e?y(new o.Z,e,t):null,c,null,d);yield f}}(l(e),t))}},40400:(e,t,n)=>{n.d(t,{MS:()=>u,Dm:()=>l,Hq:()=>p,bU:()=>a});var r=n(39994),i=n(67134),o=n(10287),s=n(86094);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.I4:"esriGeometryPolyline"===e?s.ET:s.lF}}}function l(e,t){if((0,r.Z)("csp-restrictions"))return()=>({[t]:null,...e});try{let n=`this.${t} = null;`;for(const t in e)n+=`this${t.indexOf(".")?`["${t}"]`:`.${t}`} = ${JSON.stringify(e[t])};`;const r=new Function(n);return()=>new r}catch(n){return()=>({[t]:null,...e})}}function p(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,i.d9)(e)}}]}function u(e,t){return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0},query:o.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}},53237:(e,t,n)=>{n.d(t,{w9:()=>h,j:()=>b,G4:()=>w,gp:()=>v,eS:()=>F,d:()=>S,yN:()=>C,WW:()=>I}),n(91957);var r=n(66341),i=n(70375),o=n(13802),s=n(61681),a=n(35925),l=n(39536),p=n(12065),u=n(61619),c=n(61957),d=n(40400),y=n(28790),f=n(86349),m=n(14685);const g=o.Z.getLogger("esri.layers.graphics.sources.ogcfeature");async function h(e,t,n={},o=5){const{links:a}=e,l=O(a,"items","application/geo+json")||O(a,"http://www.opengis.net/def/rel/ogc/1.0/items","application/geo+json");if((0,s.Wi)(l))throw new i.Z("ogc-feature-layer:missing-items-page","Missing items url");const{data:p}=await(0,r.default)(l.href,{signal:n.signal,query:{limit:o,...n.customParameters,token:n.apiKey},headers:{accept:"application/geo+json"}});await(0,c.O3)(p);const u=(0,c.my)(p,{geometryType:t.geometryType}),m=t.fields||u.fields||[],h=null!=t.hasZ?t.hasZ:u.hasZ,b=u.geometryType,w=t.objectIdField||u.objectIdFieldName||"OBJECTID";let v=t.timeInfo;const F=m.find((e=>e.name===w));if(F)F.type="esriFieldTypeOID",F.editable=!1,F.nullable=!1;else{if(!u.objectIdFieldType)throw new i.Z("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");m.unshift({name:w,alias:w,type:"esriFieldTypeOID",editable:!1,nullable:!1})}if(w!==u.objectIdFieldName){const e=m.find((e=>e.name===u.objectIdFieldName));e&&(e.type="esriFieldTypeInteger")}m===u.fields&&u.unknownFields.length>0&&g.warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:u.unknownFields}});for(const e of m){if(null==e.name&&(e.name=e.alias),null==e.alias&&(e.alias=e.name),"esriFieldTypeOID"!==e.type&&"esriFieldTypeGlobalID"!==e.type&&(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable),!e.name)throw new i.Z("ogc-feature-layer:invalid-field-name","field name is missing",{field:e});if(-1===f.v.jsonValues.indexOf(e.type))throw new i.Z("ogc-feature-layer:invalid-field-type",`invalid type for field "${e.name}"`,{field:e})}if(v){const e=new y.Z(m);if(v.startTimeField){const t=e.get(v.startTimeField);t?(v.startTimeField=t.name,t.type="esriFieldTypeDate"):v.startTimeField=null}if(v.endTimeField){const t=e.get(v.endTimeField);t?(v.endTimeField=t.name,t.type="esriFieldTypeDate"):v.endTimeField=null}if(v.trackIdField){const t=e.get(v.trackIdField);t?v.trackIdField=t.name:(v.trackIdField=null,g.warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:v}}))}v.startTimeField||v.endTimeField||(g.warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:v}}),v=null)}return{drawingInfo:b?(0,d.bU)(b):null,geometryType:b,fields:m,hasZ:!!h,objectIdField:w,timeInfo:v}}async function b(e,t={}){const{links:n}=e,o=O(n,"data","application/json")||O(n,"http://www.opengis.net/def/rel/ogc/1.0/data","application/json");if((0,s.Wi)(o))throw new i.Z("ogc-feature-layer:missing-collections-page","Missing collections url");const{apiKey:a,customParameters:l,signal:p}=t,{data:u}=await(0,r.default)(o.href,{signal:p,headers:{accept:"application/json"},query:{...l,token:a}});return u}async function w(e,t={}){const{links:n}=e,o=O(n,"conformance","application/json")||O(n,"http://www.opengis.net/def/rel/ogc/1.0/conformance","application/json");if((0,s.Wi)(o))throw new i.Z("ogc-feature-layer:missing-conformance-page","Missing conformance url");const{apiKey:a,customParameters:l,signal:p}=t,{data:u}=await(0,r.default)(o.href,{signal:p,headers:{accept:"application/json"},query:{...l,token:a}});return u}async function v(e,t={}){const{apiKey:n,customParameters:i,signal:o}=t,{data:s}=await(0,r.default)(e,{signal:o,headers:{accept:"application/json"},query:{...i,token:n}});return s}async function F(e,t={}){const n="application/vnd.oai.openapi+json;version=3.0",i=O(e.links,"service-desc",n);if((0,s.Wi)(i))return g.warn("ogc-feature-layer:missing-openapi-page","The OGC API-Features server does not have an OpenAPI page."),null;const{apiKey:o,customParameters:a,signal:l}=t,{data:p}=await(0,r.default)(i.href,{signal:l,headers:{accept:n},query:{...a,token:o}});return p}function S(e){const t=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(e),n=null==t?void 0:t.groups;if(!n)return null;const{authority:r,code:i}=n;switch(r.toLowerCase()){case"ogc":switch(i.toLowerCase()){case"crs27":return m.Z.GCS_NAD_1927.wkid;case"crs83":return 4269;case"crs84":case"crs84h":return m.Z.WGS84.wkid;default:return null}case"esri":case"epsg":{const e=Number.parseInt(i,10);return Number.isNaN(e)?null:e}default:return null}}async function C(e,t,n){const r=await I(e,t,n);return(0,p.cn)(r)}async function I(e,t,n){const{capabilities:{query:{maxRecordCount:o}},collection:d,layerDefinition:y,queryParameters:{apiKey:f,customParameters:g},spatialReference:h,supportedCrs:b}=e,{links:w}=d,v=O(w,"items","application/geo+json")||O(w,"http://www.opengis.net/def/rel/ogc/1.0/items","application/geo+json");if((0,s.Wi)(v))throw new i.Z("ogc-feature-layer:missing-items-page","Missing items url");const{geometry:F,num:S,start:C,timeExtent:I,where:j}=t;if(t.objectIds)throw new i.Z("ogc-feature-layer:query-by-objectids-not-supported","Queries with objectids are not supported");const _=m.Z.fromJSON(h),P=(0,s.Pt)(t.outSpatialReference,_),R=P.isWGS84?null:T(P,b),Z=x(F,b),D=function(e){if((0,s.Wi)(e))return null;const{start:t,end:n}=e;return`${(0,s.pC)(t)?t.toISOString():".."}/${(0,s.pC)(n)?n.toISOString():".."}`}(I),k=(N=j,(0,s.Wi)(N)||!N||"1=1"===N?null:N),G=null!=S?S:null!=C&&void 0!==C?10:o,{data:M}=await(0,r.default)(v.href,{...n,query:{...g,...Z,crs:R,datetime:D,query:k,limit:G,startindex:C,token:f},headers:{accept:"application/geo+json"}});var N;let q=!1;M.links&&(q=!!M.links.find((e=>"next"===e.rel))),!q&&Number.isInteger(M.numberMatched)&&Number.isInteger(M.numberReturned)&&(q=M.numberReturned<M.numberMatched);const{fields:E,globalIdField:W,hasM:Q,hasZ:A,objectIdField:L}=y,B=y.geometryType,$=(0,c.lG)(M,{geometryType:B,hasZ:A,objectIdField:L});if(!R&&P.isWebMercator)for(const e of $)if((0,s.pC)(e.geometry)){const t=(0,p.di)(e.geometry,B,A,!1);t.spatialReference=m.Z.WGS84,e.geometry=(0,p.GH)((0,l.iV)(t,P))}for(const e of $)e.objectId=e.attributes[L];const J=R||!R&&P.isWebMercator?P.toJSON():a.Zn,U=new u.Z;return U.exceededTransferLimit=q,U.features=$,U.fields=E,U.geometryType=B,U.globalIdFieldName=W,U.hasM=Q,U.hasZ=A,U.objectIdFieldName=L,U.spatialReference=J,U}function T(e,t){var n;const{isWebMercator:r,wkid:i}=e;return i?r?null!=(o=null!=(s=null!=(a=null!=(l=t[3857])?l:t[102100])?a:t[102113])?s:t[900913])?o:null:null!=(n=t[e.wkid])?n:null:null;var o,s,a,l}function j(e){if((0,s.Wi)(e))return"";const{xmin:t,ymin:n,xmax:r,ymax:i}=e;return`${t},${n},${r},${i}`}function x(e,t){if(!function(e){return(0,s.pC)(e)&&"extent"===e.type}(e))return null;const{spatialReference:n}=e;if(!n||n.isWGS84)return{bbox:j(e)};const r=T(n,t);return r?{bbox:j(e),"bbox-crs":r}:n.isWebMercator?{bbox:j((0,l.iV)(e,m.Z.WGS84))}:null}function O(e,t,n){return e.find((e=>e.rel===t&&e.type===n))||e.find((e=>e.rel===t&&!e.type))}}}]);